<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
    <script>
        require.config({
            paths: {
                'jquery': '//code.jquery.com/jquery-1.11.0.min',
                'underscore': '//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min',
                'webhome': '../src/webhome',
                'furniture': '../src/furniture',
                'fabric': "//cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min"
//                'fabric': "../vendor/fabric.js-1.4.0/dist/all.require"
            },
            shim: {
                "underscore": {
                    exports: "_"
                },
                "fabric": {
                    exports: "fabric"
                }
            }
        });
    </script>
</head>
<body>

<div>
    <h3>Testing </h3>
    <canvas id="test" width="640" height="480"></canvas>
</div>
<script>
    require(['webhome', 'furniture/abstract'], function(WebHome, AFurniture){
//        console.log(new WebHome('test'));
        //first, we create the webhome controller based our canvas.
        var homectl = new WebHome('test');
        var jsondata = {
            "objects": [
                {
                    "type": "furniture",
                    "src": "https://www.google.com.ua/images/srpr/logo11w.png",
                    "left": 50,
                    "top": 50,
                    "width": 300,
                    "height": 100,
                    "overlayFill": null, "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "scaleX": 1, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "selectable": true, "hasControls": true, "hasBorders": true, "hasRotatingPoint": false, "transparentCorners": true, "perPixelTargetFind": false, "rx": 0, "ry": 0
                },
                {
                    "type": "rect", "left": 50, "top": 50, "width": 20, "height": 20, "fill": "green", "overlayFill": null, "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "scaleX": 1, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "selectable": true, "hasControls": true, "hasBorders": true, "hasRotatingPoint": false, "transparentCorners": true, "perPixelTargetFind": false, "rx": 0, "ry": 0
                },
                {"type": "circle", "left": 100, "top": 100, "width": 100, "height": 100, "fill": "red", "overlayFill": null, "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "scaleX": 1, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "selectable": true, "hasControls": true, "hasBorders": true, "hasRotatingPoint": false, "transparentCorners": true, "perPixelTargetFind": false, "radius": 50}
            ],
            "background": "rgba(0, 0, 0, 0)"
        };

        //we will using backbone.js to sync the data with remote server, after get the data, we set the dataset.
        //You need to define the jsondata format.
        //Notice: the jsondata can using Fabric json directly, we only need extend a few property.
        //All of this property is pre-defined data. you can totally ignore the problem how to prepare the data.
        ///VERY IMPORT: please give the exactly definition of this JSONDATA.
        homectl.setHomeData(jsondata, function(){
            homectl.setState('view');
        });
//        AFurniture.fromURL('https://www.google.com.ua/images/srpr/logo11w.png', function(img){
//            homectl._scene.add(img);
//        });
//        AFurniture.fromObject({
//                    "type": "furniture",
//                    "src": "https://www.google.com.ua/images/srpr/logo11w.png",
//                    "left": 50,
//                    "top": 50,
//                    "width": 300,
//                    "height": 100,
//                    "overlayFill": null, "stroke": null, "strokeWidth": 1, "strokeDashArray": null, "scaleX": 1, "scaleY": 1, "angle": 0, "flipX": false, "flipY": false, "opacity": 1, "selectable": true, "hasControls": true, "hasBorders": true, "hasRotatingPoint": false, "transparentCorners": true, "perPixelTargetFind": false, "rx": 0, "ry": 0
//                },function(img){
//            homectl._scene.add(img);
//        });
        //after this call, the canvas will be showed.

        //set home controller to enter an edit mode. In this mode, the controller is responsible react with mouse/touch/keyboard to replace some furniture. This is default mode after create. another mode is Draw used to draw wall.
        //homectl.getState(); //we can get current home controller state through this function.


        //connect an event from homectl.
        //at now, we support one event 'replace'. If user click on a furniture. the callback called. clicked object as the parameter.
        homectl.on('replace', function (obj) {
            //We will show a ui let user to select new object.
        });
        homectl.on('hover', function (obj) {
            console.log(obj);
            //notify when mouse over a furniture object. We will show a div with furniture information upon it.
        });

        //After user select a furniture with same type . we will replace the old furniture.
        //$(.xxx).on('click',function(){

        //the follow action function is called after furniture data is received.
//        homectl.replace(obj, newobj);
        //same with top, except the second parameter is id.
//        homectl.replaceId(objid, newobj);

        //last, we try to get current persist object of current scene from webhome controller.
        jsondata = homectl.getJson();
    });
</script>
</body>
</html>