<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
    <script>
        require.config({
            paths: {
                'jquery': '//code.jquery.com/jquery-1.11.0.min',
                'lodash': '//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash',
                'webhome': '../src',
                'furniture': '../src/furniture',
                'fabric': "//cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min"
//                'fabric': "../vendor/fabric.js-1.4.0/dist/all.require"
            },
            shim: {
                "fabric": {
                    exports: "fabric"
                }
            }
        });
    </script>
</head>
<body>
    <div>
        <h3>Testing </h3>
        <div style="float: left;">
            <canvas id="test" width="642" height="642"></canvas>
        </div>
        <div style="float: left;">
            <button id="view-mode">View</button>
            <button id="edit-mode">Edit Mode</button>
            <button id="wall-mode">Wall Mode</button>
        </div>
    </div>
    <script>
        require(['webhome/webhome', 'webhome/furniture/wall', 'webhome/wallEditor'], function (WebHome, Wall, WallEditor) {
            var
                homectl = new WebHome('test'),
                drawRules = function(canvas, gridsize){
                    var
                        lineCount = 0,
                        halfWidth = canvas.width/2
                    ;
                    for(var x=0;lineCount<(canvas.width*2/gridsize);x++)
                    {
                        canvas.add(new fabric.Line([gridsize*x - halfWidth, -halfWidth -5, gridsize*x - halfWidth, halfWidth],{ stroke: "#ccc", strokeWidth: 2, selectable:false, strokeDashArray: [5, 5]}));
                        canvas.add(new fabric.Line([-halfWidth -5, gridsize*x - halfWidth, halfWidth, gridsize*x - halfWidth],{ stroke: "#ccc", strokeWidth: 2, selectable:false, strokeDashArray: [5, 5]}));
                        lineCount++;
                    }
                }
            ;
            homectl._scene.setBackgroundColor('#eee');

            document.querySelector('#view-mode').addEventListener('click', function(){
                homectl.setState('view');
            });
            document.querySelector('#edit-mode').addEventListener('click', function(){
                homectl.setState('edit');
            });
            document.querySelector('#wall-mode').addEventListener('click', function(){
                homectl.setState('wall');
            });
            //draw rules for
            drawRules(homectl._scene, 40);
        });

        //connect an event from homectl.
        //drawed event fired after user finished a house style.
        homectl.on('drawed', function (objarray) {
            //
        });


        //The follow function is valid only when current selected object is a wall.
        //This give the actual length of a wall. Using this to resize all wall's size and keep the proportion.
        homectl.decideSize(length);
        //Because all of our furniture mark the real size. So this step is needed.
        //We need check this flag to ensure we save the real size in our data.
        homectl.isSizeDetermined();


    </script>
</body>
</html>